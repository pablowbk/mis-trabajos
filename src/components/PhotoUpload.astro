---
// Componente para cargar una foto con nombre y etiqueta
const { visible = false, onClose = () => {}, onAdd = () => {} } = Astro.props;
let nombre = '';
let etiqueta = '';
let foto = null;
let mensaje = '';

function handleSubmit(e) {
  e.preventDefault();
  if (!foto) {
    mensaje = 'Por favor selecciona una foto.';
    return;
  }
  const reader = new FileReader();
  reader.onload = function(ev) {
    onAdd({
      nombre,
      etiqueta,
      url: ev.target.result
    });
    nombre = '';
    etiqueta = '';
    foto = null;
    mensaje = '';
    onClose();
  };
  reader.readAsDataURL(foto);
}

if (!visible) {
  return null;
}
---
<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative">
    <button class="absolute top-2 right-2 text-gray-400 hover:text-gray-600" type="button" on:click={onClose}>&times;</button>
    <h2 class="text-xl font-bold mb-4">Subir foto</h2>
    <form on:submit={handleSubmit} class="flex flex-col gap-4">
      <label>
        Nombre de la foto:
        <input type="text" bind:value={nombre} class="input input-bordered w-full" required />
      </label>
      <label>
        Etiqueta:
        <input type="text" bind:value={etiqueta} class="input input-bordered w-full" required />
      </label>
      <label>
        Selecciona una foto:
        <input type="file" accept="image/*" on:change={(e) => foto = e.target.files[0]} class="file-input w-full" required />
      </label>
      <button type="submit" class="btn btn-primary">Subir foto</button>
      {mensaje && <div class="text-green-600">{mensaje}</div>}
    </form>
  </div>
</div>
